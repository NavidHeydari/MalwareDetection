# -*- coding: utf-8 -*-
"""
Created on Wed Feb 12 18:25:13 2019

@author: Navid Heydari
"""
import pandas as pd
import sys
import numpy as np; np.random.seed(4321)
import seaborn as sns
from sklearn.preprocessing import LabelEncoder
import warnings
warnings.filterwarnings("ignore")

data = pd.read_csv(sys.argv[1])

#dropping machine ID column
data = data.drop('MachineIdentifier',axis=1)
#-----------------------------------------------
#cleanup some fields after few CORR run 
data = data.drop('DefaultBrowsersIdentifier',axis=1)
data = data.drop('PuaMode',axis=1)
data = data.drop('Census_IsWIMBootEnabled',axis=1)

label_encoder = LabelEncoder()
data.iloc[:,0] = label_encoder.fit_transform(data.iloc[:,0]).astype('float64')
#data.iloc[:,-1] = label_encoder.fit_transform(data.iloc[:,-1]).astype('int32') # class column
#data.iloc[:,4] = label_encoder.fit_transform(data.iloc[:,4]).astype('int32') # index 4 IsBeta
##data.iloc[27] = label_encoder.fit_transform(data.iloc[:27]).astype('int32')# 'AutoSampleOptIn' index 27
#data.iloc[:,61] = label_encoder.fit_transform(data.iloc[:,61]).astype('int32') #Census_OSInstallLanguageIdentifier col 61
#data.iloc[:,64] = label_encoder.fit_transform(data.iloc[:,64]).astype('int32') #Census_IsPortableOperatingSystem -- col 64
#data.iloc[:,-8] = label_encoder.fit_transform(data.iloc[:,-8]).astype('int32')#Census_IsWIMBootEnabled -- col -8

correlation = data.corr()
#correlation heat map
sns.heatmap(correlation, annot=False)
print(correlation)

#filtering all the columns/feature we want to process
columns = [] #set()
for i in range(correlation.shape[0]):
    for j in range(i+1, correlation.shape[0]):
        if correlation.iloc[i,j] < 0.9:
            columns.append(correlation.columns[i])

selected_columns = np.unique(columns) 
print("selected_columns:",selected_columns , " | selectedColumns.size=",selected_columns.size)
print("before filtering data -- data.size=",len(data.columns))
data = data[selected_columns]
print("after filtering by selected feature -- data.size=",len(data.columns))
 